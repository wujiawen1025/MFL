/*
========================================================================================================================
**【文件描述】                                        【文件描述】                                        【文件描述】**
========================================================================================================================
**    文件名称: LED.c                                                                                                         
**
**    功能描述: 灯光驱动
**
**    公    司：蒙发利电子
**
**    项目名称：
**
**    平台信息：
**
**    作    者：Hzy
**
**    其他说明:
**
**    修改记录:  --------------------------------------------------------------
**
========================================================================================================================
========================================================================================================================
*/

/*
========================================================================================================================
* 【文件包含】                                         【文件包含】                                          【文件包含】
========================================================================================================================
*/
#include "LED.h"
#include "ESF.h"


/*
========================================================================================================================
*【本地宏定义】                                       【本地宏定义】                                       【本地宏定义】
========================================================================================================================
*/


/*
========================================================================================================================
*【本地数据类型定义】                              【本地数据类型定义】                              【本地数据类型定义】
========================================================================================================================
*/


/*
========================================================================================================================
*【变量定义 & 各种声明】                          【变量定义 & 各种声明】                          【变量定义 & 各种声明】    
========================================================================================================================
*/
static Led_t   Led;
Led_t   *pLed = &Led;


/*
========================================================================================================================
*【函数定义】                                          【函数定义】                                          【函数定义】
========================================================================================================================
*/
/*
************************************************************************************************************************
* 函数名称 : Led_PauseOn                                                                                                         
* 功能描述 : 暂停功能                                                                                     
* 输入参数 : 无                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_PauseOn(void)
{
  #if(1==LED_EN)
  if(pLed->CSFlag.Bit.Pause < 0x1F)
  {
    pLed->CSFlag.Bit.Pause++;
  }
  #endif
}

/*
************************************************************************************************************************
* 函数名称 : Led_PauseOff                                                                                                         
* 功能描述 : 解除暂停                                                                                     
* 输入参数 : 无                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_PauseOff(void)
{
  #if(1==LED_EN)
  if(pLed->CSFlag.Bit.Pause > 0)
  {
    pLed->CSFlag.Bit.Pause--;
  }
  #endif
}

/*
************************************************************************************************************************
* 函数名称 : Led_SetWorkState      
* 功能描述 : 设置灯光的工作与不工作                                                                                     
* 输入参数 : TrueFalse -- TRUE  工作
*                         FALSE 不工作                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_SetWorkState(uint8_t TrueFalse)
{
  #if(1==LED_EN)
  if((TrueFalse != TRUE) && (TrueFalse != FALSE))
  {
    TrueFalse = FALSE;
  }
  pLed->CSFlag.Bit.Work = TrueFalse;
  #endif
}

/*
************************************************************************************************************************
* 函数名称 : Led_SetLogoWorkState      
* 功能描述 : 设置灯光的工作与不工作                                                                                     
* 输入参数 : TrueFalse -- TRUE  工作
*                         FALSE 不工作                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_SetLogoWorkState(uint8_t TrueFalse)
{
  #if(1==LED_EN)
  if((TrueFalse != TRUE) && (TrueFalse != FALSE))
  {
    TrueFalse = FALSE;
  }
  pLed->CSFlag.Bit.LogoWork = TrueFalse;
  #endif
}

/*
************************************************************************************************************************
* 函数名称 : Led_SetProjectionWorkState      
* 功能描述 : 设置灯光的工作与不工作                                                                                     
* 输入参数 : TrueFalse -- TRUE  工作
*                         FALSE 不工作                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_SetProjectionWorkState(uint8_t TrueFalse)
{
  #if(1==LED_EN)
  if((TrueFalse != TRUE) && (TrueFalse != FALSE))
  {
    TrueFalse = FALSE;
  }
  pLed->CSFlag.Bit.ProjectionWork = TrueFalse;
  #endif
}

/*
************************************************************************************************************************
* 函数名称 : Led_AllPartsHandle                                                                                                         
* 功能描述 :                                                                                 
* 输入参数 : ExePeriod -- 函数的执行周期                                                                                    
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_AllPartsHandle(Ticker_t ExePeriod)
{
  #if(1==LED_EN)
  
  if(TRUE == pLed->CSFlag.Bit.LogoWork) /*工作*/
  {
    BSP_IO_SetOutput_LedLogo(ON);
  }
  else
  {
    BSP_IO_SetOutput_LedLogo(OFF);
  }

  if(TRUE == pLed->CSFlag.Bit.ProjectionWork) /*工作*/
  {
    BSP_IO_SetOutput_LedProjection(ON);
  }
  else
  {
    BSP_IO_SetOutput_LedProjection(OFF);
  }
  
  #endif
}

/*
========================================================================================================================
*           功能函数表                             功能函数表                             功能函数表
========================================================================================================================
*/
#define  LED_TICK_COUNT_BUF_NUM   1
static Ticker_t Led_TickCount[LED_TICK_COUNT_BUF_NUM];

static const ESF_TmrExeFunc_t  Led_TmrExeFuncTab[] = 
{
  /*   执行函数             执行周期(ms)        时间计数变量*/
  {Led_AllPartsHandle,        777,            &Led_TickCount[0]}

};

#define  LED_TMR_EXE_FUNC_TAB_NUM     TAB_NUM(Led_TmrExeFuncTab)

/*
************************************************************************************************************************
* 函数名称 : Led_Handle                                                                                                         
* 功能描述 : 灯光处理                                                                                     
* 输入参数 : 无                                                                                      
* 返回参数 : 无                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void Led_Handle(void)
{
  /*调度功能函数表------------------------------------------------*/
  ESF_TmrExeFuncScheduling(Led_TmrExeFuncTab, LED_TMR_EXE_FUNC_TAB_NUM);
}


/*
************************************************************************************************************************
* 函数名称 : Led_Init                                                                                                         
* 功能描述 : 灯光初始化                                                                                     
* 输入参数 : 无                                                                                      
* 返回参数 : 返回 可操作振动功能 的结构体 的指针                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
Led_t*  Led_Init(void)
{
  /*初始化相关数据------------------------------------------------------*/
  memset(pLed, 0, sizeof(Led_t)); /*清零所有数据*/

  /*检测 Vib_TmrExeFuncTab 功能函数表排列是否正确-----------------------*/
  ESF_TmrExeFuncTabCheck(Led_TmrExeFuncTab, LED_TMR_EXE_FUNC_TAB_NUM, LED_TICK_COUNT_BUF_NUM);
  
  return pLed;
}


/*
************************************************************************************************************************
* 函数名称 : Vib_GetCSFlag                                                                                                         
* 功能描述 : 获得 控制 与 状态 标识                                                                                     
* 输入参数 : 无                                                                                      
* 返回参数 : 控制与状态标识 的结构体                                                                 
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
LedCSFlag_t Led_GetCSFlag(void)
{
  return pLed->CSFlag;
}
