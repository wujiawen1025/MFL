/*
========================================================================================================================
**【文件描述】                                        【文件描述】                                        【文件描述】**
========================================================================================================================
**    文件名称: CDP_CenDebug.c                                                                                                         
**
**    功能描述: 通信数据包   之   中心板 <--> 上位机。
**
**    公    司: 蒙发利电子
**
**    项目名称:
**
**    平台信息:
**
**    作    者: LZH
**
**    其他说明: 
**
**    修改记录:  --------------------------------------------------------------
**
========================================================================================================================
========================================================================================================================
*/

/*
========================================================================================================================
* 【文件包含】                                         【文件包含】                                          【文件包含】
========================================================================================================================
*/
#include "CDP_CenDebug.h"
#include "CDP.h"


/*
========================================================================================================================
*【本地宏定义】                                       【本地宏定义】                                       【本地宏定义】
========================================================================================================================
*/
#define  CEN_DEBUG_RX_BUF_SIZE                 (ESF_MEM_BOLCK_BYTE_SIZE - (ESF_MEM_BOLCK_BYTE_SIZE/4))  /*接收缓存大小，最多占内存块的3/4*/
#define  CEN_DEBUG_TX_BUF_SIZE                 (CEN_DEBUG_RX_BUF_SIZE)                                  /*发送缓存大小*/
#define  CEN_DEBUG_UART_PORT                   BSP_UART_Port2                                           /*所用串口*/

/*
========================================================================================================================
*【本地数据类型定义】                              【本地数据类型定义】                              【本地数据类型定义】
========================================================================================================================
*/


/*
========================================================================================================================
*【变量定义 & 各种声明】                          【变量定义 & 各种声明】                          【变量定义 & 各种声明】    
========================================================================================================================
*/
static CDP_CenDebug_t CDP_CenDebug;
CDP_CenDebug_t *pCDP_CenDebug = &CDP_CenDebug;

/*
========================================================================================================================
*【函数定义】                                          【函数定义】                                          【函数定义】
========================================================================================================================
*/

/*
************************************************************************************************************************
* 函数名称 : CDP_CenDebug_ByteRx                                                                                                         
* 功能描述 : 通信数据包   之    中心板 <--> 上位机   字节接收处理                                                                              
* 输入参数 : RxByte -- 收到的字节数据                                                                    
* 返回参数 : 无                                                             
* 补充说明 : 该函数必须通过BSP_UART_RegRxByteCB()注册给BSP层，以便在串口接收字节中断中调用。                                                                                                  
************************************************************************************************************************
*/
static void CDP_CenDebug_ByteRx(uint8_t RxByte)
{
  uint8_t SrcAddr;
  
  pCDP_CenDebug->FrameRx.RxLenMax = CEN_DEBUG_RX_BUF_SIZE;
  SrcAddr = CDP_FrameRxHandle(&pCDP_CenDebug->FrameRx, RxByte, CDP_TYPE_NEW_PROTOCOL, CDP_DAP_CEN);
  
}

/*
************************************************************************************************************************
* 函数名称 : CDP_CenDebug_DataTx                                                                                                         
* 功能描述 : 通信数据包   之  中心板 <--> 上位机      数据发送                                                                      
* 输入参数 : pTXData -- 要发送的数据   
*            TxLen   -- 发送长度 
* 返回参数 : BSP_UART_TxState_Busy  -- 发送忙，无法处理发送pTxBuf指向的的数据。
*            其他值                 -- 串口开始发送pTxBuf指向的的数据了。
* 补充说明 : 无                                                                                                  
************************************************************************************************************************
*/
uint8_t CDP_CenDebug_DataTx(ESF_Evt_t *pEvt)
{
  static uint8_t FrameTxBuf[CEN_DEBUG_TX_BUF_SIZE];

  return CDP_FrameTxHandle(pEvt, FrameTxBuf, CEN_DEBUG_UART_PORT);
}

/*
************************************************************************************************************************
* 函数名称 : CDP_CenDebug_Init                                                                                                         
* 功能描述 : 通信数据包   之   中心板 <--> 上位机   初始化                                                                               
* 输入参数 : 无                                                            
* 返回参数 : 返回 可操作的结构体 的指针                                                             
* 补充说明 : 无                                                                                                  
************************************************************************************************************************
*/
CDP_CenDebug_t* CDP_CenDebug_Init(void)
{
  /*初始化相关数据------------------------------------------*/

  memset(pCDP_CenDebug, 0, sizeof(CDP_CenDebug_t));
  BSP_UART_RegRxByteCB(CEN_DEBUG_UART_PORT, CDP_CenDebug_ByteRx);   /*注册串口接收处理函数*/

  return pCDP_CenDebug;
}


