/*
========================================================================================================================
**【文件描述】                                        【文件描述】                                        【文件描述】**
========================================================================================================================
**    文件名称: System.c 
**
**    功能描述:
**
**    公    司：蒙发利电子
**
**    项目名称：
**
**    平台信息：
**
**    作    者：Hzy
**
**    其他说明:
**
**    修改记录:  --------------------------------------------------------------
**
========================================================================================================================
========================================================================================================================
*/
/*
========================================================================================================================
* 【文件包含】                                         【文件包含】                                          【文件包含】
========================================================================================================================
*/
#include "System.h"


/*
========================================================================================================================
*【本地宏定义】                                       【本地宏定义】                                       【本地宏定义】
========================================================================================================================
*/


/*
========================================================================================================================
*【本地数据类型定义】                              【本地数据类型定义】                              【本地数据类型定义】
========================================================================================================================
*/

 /*
************************************************************************************************************************
* 类型定义 :  直接单独调试控制底层驱动电路                                                                                                      
************************************************************************************************************************
*/


/*
========================================================================================================================
*【变量定义 & 各种声明】                          【变量定义 & 各种声明】                          【变量定义 & 各种声明】    
========================================================================================================================
*/


/*
========================================================================================================================
*【函数定义】                                          【函数定义】                                          【函数定义】
========================================================================================================================
*/
/*
************************************************************************************************************************
* 函数名称 : System_EvtHandle_CDPRx                                                                                                         
* 功能描述 : 事件处理 之 通信数据包接收                                                                                        
* 输入参数 : pEvt -- 事件                                                                                  
* 返回参数 : MEM_IDLE --  事件内存空闲，可以释放了        
*            MEM_USE  --  事件内存还在使用中，还不能释放                                                                   
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
#define System_EvtHandle_CDPRx     CDP_PDURxHandle
//uint8_t System_EvtHandle_CDPRx(ESF_Evt_t *pEvt)
//{
//}

/*
************************************************************************************************************************
* 函数名称 : System_EvtHandle_CDPTx                                                                                                         
* 功能描述 : 事件处理 之 通信数据包发送                                                                                        
* 输入参数 : pEvt -- 事件                                                                                  
* 返回参数 : MEM_IDLE --  事件内存空闲，可以释放了        
*            MEM_USE  --  事件内存还在使用中，还不能释放                                                                   
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
#define System_EvtHandle_CDPTx     CDP_PDUTxHandle
//uint8_t System_EvtHandle_CDPTx(ESF_Evt_t *pEvt)
//{
//}

/*
========================================================================================================================
*【要处理的事件 表格】                             【要处理的事件 表格】                            【要处理的事件 表格】
*
* 注意：1、这里尽量只处理被动（随机）发生事件。 如按键，串口接收手控端的控制命令等。
*       2、该表格的内容直接用下标取用，因此请按从小到大无空缺的排列事件类型。
*          如果不能保证如此排列，请修改代码改变内容取用方式，如for循环或折半查找。 
========================================================================================================================
*/
static const ESF_EvtTabItem_t EvtTab[ESF_EVT_MAX] = 
{
  /*事件类型*/       /*事件对应的处理函数*/
  {EvtCDPRx,        System_EvtHandle_CDPRx},         /*事件: 通信数据包接收*/
  {EvtCDPTx,        System_EvtHandle_CDPTx},         /*事件: 通信数据包发送*/
  {EvtKey,          NULL}     
};
#define EVT_TAB_ISUM  TAB_ISUM(EvtTab)
/*
************************************************************************************************************************
* 函数名称 : System_EvtHandle                                                                                                         
* 功能描述 : 事件处理                                                                                        
* 输入参数 : 无                                                                                  
* 返回参数 : 无                                                                   
* 补充说明 : 主要处理 被动（随机）发生事件。 如按键，数据包收发等。                                                                                                         
************************************************************************************************************************
*/
void System_EvtHandle(void)
{
//  ESF_Evt_t *pEvt;
//  uint8_t  EvtMemState;
//  uint8_t  i;
//  
//  pEvt = ESF_EvtQuene_Pend();                               /*查阅事件队列*/  
//  if(NULL == pEvt)                                          /*无事件发生*/
//  {
//    return;
//  }

//  EvtMemState = MEM_IDLE;                                   /*先假设事件所占内存已无用*/
//  for(i=0; i<EVT_TAB_ISUM; i++)
//  {
//    if(EvtTab[i].Type == pEvt->Type)
//    {
//      if(EvtTab[i].pEvtFunc != NULL)
//      {
//        EvtMemState = EvtTab[i].pEvtFunc(pEvt);             /*处理发生的事件*/
//      }
//      break;
//    }
//  }

//  if(MEM_IDLE == EvtMemState)                               /*事件所占内存无用了*/
//  {
//    ESF_MemBuf_Free(pEvt);                                  /*释放事件所占用的内存空间*/
//  }
}


/*
************************************************************************************************************************
* 函数名称 : System_Handle                                                                                                         
* 功能描述 : 系统处理                                                                                            
* 输入参数 : 无                                                                                                         
* 返回参数 : 无                                                                                                         
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void System_Handle(void)
{
//  System_EvtHandle();
  CDP_Handle();
//  IAP_Handle();
}

/*
************************************************************************************************************************
* 函数名称 : System_Init                                                                                                         
* 功能描述 : 系统初始化                                                                                            
* 输入参数 : 无                                                                                                         
* 返回参数 : 无                                                                                                         
* 补充说明 : 无                                                                                                         
************************************************************************************************************************
*/
void System_Init(void)
{
  BSP_Init();                                           
  ESF_Init();                                          
  CDP_Init(); 
}
